<!DOCTYPE html>
<!-- saved from url=(0082)https://cssicurriculum.withgoogle.com/mvc-appEngine/app-engine-form-reference.html -->
<html class="gr__cssicurriculum_withgoogle_com mdl-js"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta content="IE=edge" http-equiv="X-UA-Compatible"><meta content="width=device-width, initial-scale=1" name="viewport"><title>Google App Engine Reference 2 (with forms)</title><meta content="
          
              Google App Engine Reference 2 (with forms)
          " name="description"><link href="https://cssicurriculum.withgoogle.com/favicon.ico" rel="shortcut icon"><link href="./Google App Engine Reference 2 (with forms)_files/material.indigo-yellow.min.css" rel="stylesheet"><link href="./Google App Engine Reference 2 (with forms)_files/icon" rel="stylesheet"><script async="" src="./Google App Engine Reference 2 (with forms)_files/analytics.js.download"></script><script defer="" src="./Google App Engine Reference 2 (with forms)_files/material.min.js.download"></script><style>html,body{font-family:'Roboto','Helvetica',sans-serif;margin:0;padding:0}#verification_sent{display:None}.cssix-intro.mdl-card{width:99%;margin-bottom:2em}.cssix-intro.mdl-card>.mdl-card__supporting_text{padding:1em}.mdl-layout__header-row h3 a{color:white;text-decoration:none}#cssilogo_header{content:url('/cssilogo.png');width:80%}.admin_nav_link{color:red}.mdl-cssix .mdl-layout__header-row{padding-left:40px}.mdl-cssix .mdl-layout.is-small-screen .mdl-layout__header-row h3{font-size:inherit;padding-left:12px}.mdl-cssix .mdl-layout__tab-bar-button{display:none}.mdl-cssix .mdl-layout.is-small-screen .mdl-layout__tab-bar .mdl-button{display:none}.mdl-cssix .mdl-layout:not(.is-small-screen) .mdl-layout__tab-bar,.mdl-cssix .mdl-layout:not(.is-small-screen) .mdl-layout__tab-bar-container{overflow:visible}.cssi-main{overflow-x:visible!important;overflow-y:visible!important;overflow:visible!important}.mdl-cssix .mdl-layout__tab-bar-container{height:64px}.mdl-cssix .mdl-layout__tab-bar{padding:0;padding-left:16px;box-sizing:border-box;height:100%;width:100%}.mdl-cssix .mdl-layout__tab-bar .mdl-layout__tab{height:64px;line-height:64px;color:white}.mdl-cssix .mdl-layout__tab-bar .mdl-layout__tab.is-active::after{height:4px}.mdl-cssix main>.mdl-layout__tab-panel{padding:8px;padding-top:48px}.mdl-layout__tab#header_logout{background-color:red}.mdl-cssix .mdl-card{height:auto;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column}.mdl-cssix .mdl-card>*{height:auto}.mdl-cssix .mdl-card .mdl-card__supporting-text{margin:40px;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;padding:0;color:inherit;width:calc(100% - 80px)}.mdl-cssix .mdl-card__supporting-text h4{margin-top:0;margin-bottom:20px}.mdl-cssix .mdl-card__actions{margin:0;padding:4px 40px;color:inherit}.mdl-cssix .mdl-card__actions a{color:#00BCD4;margin:0}.mdl-cssix .mdl-card__actions a:hover,.mdl-cssix .mdl-card__actions a:active{color:inherit;background-color:transparent}.mdl-cssix .mdl-card__supporting-text+.mdl-card__actions{border-top:1px solid rgba(0,0,0,0.12)}.mdl-cssix #add{position:absolute;right:40px;top:36px;z-index:999}.mdl-list__item{min-height:.4em;padding:.3em}.material-icons.md-18{font-size:18px}.material-icons.md-24{font-size:24px}.material-icons.md-36{font-size:36px}.material-icons.md-48{font-size:48px}.post-list .toc_icon{vertical-align:middle;margin:.1em 1em}.mdl-cssix .mdl-layout__content section:not(:last-of-type){position:relative;margin-bottom:48px}.mdl-cssix section.section--center{max-width:860px}.mdl-cssix #features section.section--center{max-width:620px}.mdl-cssix section>header{display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-ms-flex-align:center;align-items:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center}.mdl-cssix section>.section__play-btn{min-height:200px}.mdl-cssix section>header>.material-icons{font-size:3rem}.mdl-cssix section>button{position:absolute;z-index:99;top:8px;right:8px}.mdl-cssix section .section__circle{display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-ms-flex-align:center;align-items:center;-webkit-justify-content:flex-start;-ms-flex-pack:start;justify-content:flex-start;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-shrink:1;-ms-flex-negative:1;flex-shrink:1}.mdl-cssix section .section__text{-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;padding-top:8px}.mdl-cssix section .section__text h5{font-size:inherit;margin:0;margin-bottom:.5em}.mdl-cssix section .section__text a{text-decoration:none}.mdl-cssix section .section__circle-container>.section__circle-container__circle{width:64px;height:64px;border-radius:32px;margin:8px 0}.mdl-cssix section.section--footer .section__circle--big{width:100px;height:100px;border-radius:50px;margin:8px 32px}.mdl-cssix .is-small-screen section.section--footer .section__circle--big{width:50px;height:50px;border-radius:25px;margin:8px 16px}.mdl-cssix section.section--footer{padding:64px 0;margin:0 -8px -8px -8px}.mdl-cssix section.section--center .section__text:not(:last-child){border-bottom:1px solid rgba(0,0,0,.13)}.mdl-cssix .mdl-card .mdl-card__supporting-text>h3:first-child{margin-bottom:24px}.mdl-cssix .mdl-layout__tab-panel:not(#overview){background-color:white}.mdl-cssix #features section{margin-bottom:72px}.mdl-cssix #features h4,#features h5{margin-bottom:16px}.mdl-cssix .toc{border-left:4px solid #C1EEF4;margin:24px;padding:0;padding-left:8px;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column}.mdl-cssix .toc h4{font-size:.9rem;margin-top:0}.mdl-cssix .toc a{color:#4DD0E1;text-decoration:none;font-size:16px;line-height:28px;display:block}.mdl-cssix .mdl-menu__container{z-index:99}.cssix-content{border-radius:2px;padding:80px 56px;margin-bottom:16px}.is-small-screen .cssix-content{padding:0 8px 16px 12px}.cssix-content a{color:#03a9f4!important}div.instructor{border:2px solid red;border-radius:12px;padding:10px}div.instructor::before{content:"Instructor Notes(The students will not see this content):";display:block;color:red;font-weight:bold}a.instructor-notes-link{color:green!important}div.unpublished{border:2px solid green;border-radius:12px;padding:10px;background-color:#deffd1}div.unpublished::before{content:"This content is not released to students yet";color:red;font-weight:bold}a.unpublished-link{color:red!important}a.next{float:right}.post-content img{width:50%;display:block;margin:auto}.post-content img.large_img{width:80%;display:block;margin:auto}.is-small-screen .mdl-layout__tab-bar-container{display:none}.mdl-layout.is-upgraded .mdl-layout__tab.is-active{color:yellow;font-weight:bold}.mdl-layout__tab.admin_link{background-color:#c71414}.mdl-layout__header .mdl-layout__drawer-button{color:yellow!important}. .mdl-mini-footer{border-top:1px solid #ccc;background-color:inherit!important;padding:8px 16px}footer .lockup{padding-left:15px;padding-top:10px}.lockup-logo,.lockup-text{display:inline-block}.va{vertical-align:middle;line-height:0}.lockup-logo{width:74px;height:24px;background-image:url(https://www.gstatic.com/images/branding/googlelogo/1x/googlelogo_color_74x24dp.png);background-size:74px 24px}.lockup-logo.lockup-dark{background-image:url(https://www.gstatic.com/images/branding/googlelogo/1x/googlelogo_dark_color_74x24dp.png);opacity:.54}@media(max-width:760px){footer .lockup{padding-top:0}}.answer{display:none;border:2px solid green;border-radius:12px;padding:1em}.hide_answer.mdl-button.mdl-js-button{display:none;!important}body,h1,h2,h3,h4,h5,h6,p,blockquote,pre,hr,dl,dd,ol,ul,figure{margin:0;padding:0}body{font-family:Helvetica,Arial,sans-serif;font-size:16px;line-height:1.5;font-weight:300;color:#111;background-color:yellow;-webkit-text-size-adjust:100%}h1,h2,h3,h4,h5,h6,p,blockquote,pre,ul,ol,dl,figure,.highlight{margin-bottom:15px}img{max-width:100%;vertical-align:middle;display:block}figure>img{display:block}figcaption{font-size:14px}ul,ol{margin-left:30px}li>ul,li>ol{margin-bottom:0}h1,h2,h3,h4,h5,h6{font-weight:300}a{color:#2a7ae2;text-decoration:none}a:visited{color:#1756a9}a:hover{color:#111;text-decoration:underline}blockquote{color:#828282;border-left:4px solid #e8e8e8;padding-left:15px;font-size:18px;letter-spacing:-1px;font-style:italic}blockquote>:last-child{margin-bottom:0}pre,code{font-size:15px;border:1px solid #e8e8e8;border-radius:3px;background-color:#eef}code{padding:1px 5px}pre{padding:8px 12px;overflow-x:scroll}pre>code{border:0;padding-right:0;padding-left:0}.wrapper{max-width:-webkit-calc(800px -(30px * 2));max-width:calc(800px -(30px * 2));margin-right:auto;margin-left:auto;padding-right:30px;padding-left:30px}@media screen and (max-width:800px){.wrapper{max-width:-webkit-calc(800px -(30px));max-width:calc(800px -(30px));padding-right:15px;padding-left:15px}}.wrapper:after,.footer-col-wrapper:after{content:"";display:table;clear:both}.icon>svg{display:inline-block;width:16px;height:16px;vertical-align:middle}.icon>svg path{fill:#828282}.site-header{border-top:5px solid #424242;border-bottom:1px solid #e8e8e8;min-height:56px;position:relative}.site-title{font-size:26px;line-height:56px;letter-spacing:-1px;margin-bottom:0;float:left}.site-title,.site-title:visited{color:#424242}.sidebar-nav{float:left;border-right:1px solid #e8e8e8}.site-nav{float:right;line-height:56px}.site-nav .menu-icon{display:none}.site-nav .page-link{color:#111;line-height:1.5}.site-nav .page-link:not(:first-child){margin-left:20px}@media screen and (max-width:600px){.site-nav{position:absolute;top:9px;right:30px;background-color:yellow;border:1px solid #e8e8e8;border-radius:5px;text-align:right}.site-nav .menu-icon{display:block;float:right;width:36px;height:26px;line-height:0;padding-top:10px;text-align:center}.site-nav .menu-icon>svg{width:18px;height:15px}.site-nav .menu-icon>svg path{fill:#424242}.site-nav .trigger{clear:both;display:none}.site-nav:hover .trigger{display:block;padding-bottom:5px}.site-nav .page-link{display:block;padding:5px 10px}}.site-footer{border-top:1px solid #e8e8e8;padding:30px 0}.footer-heading{font-size:18px;margin-bottom:15px}.contact-list,.social-media-list{list-style:none;margin-left:0}.footer-col-wrapper{font-size:15px;color:#828282;margin-left:-15px}.footer-col{float:left;margin-bottom:15px;padding-left:15px}.footer-col-1{width:-webkit-calc(35% -(30px / 2));width:calc(35% -(30px / 2))}.footer-col-2{width:-webkit-calc(20% -(30px / 2));width:calc(20% -(30px / 2))}.footer-col-3{width:-webkit-calc(45% -(30px / 2));width:calc(45% -(30px / 2))}@media screen and (max-width:800px){.footer-col-1,.footer-col-2{width:-webkit-calc(50% -(30px / 2));width:calc(50% -(30px / 2))}.footer-col-3{width:-webkit-calc(100% -(30px / 2));width:calc(100% -(30px / 2))}}@media screen and (max-width:600px){.footer-col{float:none;width:-webkit-calc(100% -(30px / 2));width:calc(100% -(30px / 2))}}.page-content{padding:30px 0}.page-heading{font-size:20px}.post-list{margin-left:0;list-style:none;display:block;flex-wrap:wrap;justify-content:flex-start}.post-list>li{flex-basis:50%}.post-meta{font-size:14px;color:#828282}.post-link{display:block;font-size:1em}.post-header,.post-footer{margin-bottom:30px}.cssi-post-title{font-size:42px;letter-spacing:-1px;line-height:1}@media screen and (max-width:800px){.cssi-post-title{font-size:36px}}.cssix-intro h1{font-size:24px;line-height:1}.cssix-intro h2{font-size:16px;line-height:1}.post-content{margin-bottom:30px}.post-content h2{font-size:32px}@media screen and (max-width:800px){.post-content h2{font-size:28px}}.post-content h3{font-size:26px}@media screen and (max-width:800px){.post-content h3{font-size:22px}}.post-content h4{font-size:20px}@media screen and (max-width:800px){.post-content h4{font-size:18px}}.PageNavigation{font-size:14px;display:block;width:auto;overflow:hidden}.PageNavigation a{display:block;width:50%;float:left;margin:1em 0}.PageNavigation .next{text-align:right}.highlight .c{color:#998;font-style:italic}.highlight .err{color:#a61717;background-color:#e3d2d2}.highlight .k{font-weight:bold}.highlight .o{font-weight:bold}.highlight .cm{color:#998;font-style:italic}.highlight .cp{color:#999;font-weight:bold}.highlight .c1{color:#998;font-style:italic}.highlight .cs{color:#999;font-weight:bold;font-style:italic}.highlight .gd{color:#000;background-color:#fdd}.highlight .gd .x{color:#000;background-color:#faa}.highlight .ge{font-style:italic}.highlight .gr{color:#a00}.highlight .gh{color:#999}.highlight .gi{color:#000;background-color:#dfd}.highlight .gi .x{color:#000;background-color:#afa}.highlight .go{color:#888}.highlight .gp{color:#555}.highlight .gs{font-weight:bold}.highlight .gu{color:#aaa}.highlight .gt{color:#a00}.highlight .kc{font-weight:bold}.highlight .kd{font-weight:bold}.highlight .kp{font-weight:bold}.highlight .kr{font-weight:bold}.highlight .kt{color:#458;font-weight:bold}.highlight .m{color:#099}.highlight .s{color:#d14}.highlight .na{color:#008080}.highlight .nb{color:#0086B3}.highlight .nc{color:#458;font-weight:bold}.highlight .no{color:#008080}.highlight .ni{color:#800080}.highlight .ne{color:#900;font-weight:bold}.highlight .nf{color:#900;font-weight:bold}.highlight .nn{color:#555}.highlight .nt{color:#000080}.highlight .nv{color:#008080}.highlight .ow{font-weight:bold}.highlight .w{color:#bbb}.highlight .mf{color:#099}.highlight .mh{color:#099}.highlight .mi{color:#099}.highlight .mo{color:#099}.highlight .sb{color:#d14}.highlight .sc{color:#d14}.highlight .sd{color:#d14}.highlight .s2{color:#d14}.highlight .se{color:#d14}.highlight .sh{color:#d14}.highlight .si{color:#d14}.highlight .sx{color:#d14}.highlight .sr{color:#009926}.highlight .s1{color:#d14}.highlight .ss{color:#990073}.highlight .bp{color:#999}.highlight .vc{color:#008080}.highlight .vg{color:#008080}.highlight .vi{color:#008080}.highlight .il{color:#099}</style><link href="http://cssicurriculum.withgoogle.com/mvc-appEngine/app-engine-form-reference.html" rel="canonical"><link href="http://cssicurriculum.withgoogle.com/feed.xml" rel="alternate" title="Google CSSI" type="application/rss+xml"></head><body class="mdl-color--grey-100 mdl-color-text--grey-700 mdl-cssix" data-gr-c-s-loaded="true"><div class="mdl-layout__container has-scrolling-header"><div class="mdl-layout mdl-js-layout mdl-layout--fixed-header mdl-layout--no-desktop-drawer-button has-drawer is-small-screen has-tabs is-upgraded" data-upgraded=",MaterialLayout"><header class="mdl-layout__header mdl-layout__header--scroll mdl-color--primary mdl-color-text--white"><div aria-expanded="false" role="button" tabindex="0" class="mdl-layout__drawer-button"><i class="material-icons"></i></div><div class="mdl-layout--large-screen-only mdl-layout__header-row"></div><div class="mdl-layout__header-row"><a href="https://cssicurriculum.withgoogle.com/" id="cssilogo_header"></a></div><div class="mdl-layout--large-screen-only mdl-layout__header-row"></div><div class="mdl-layout__tab-bar-container"><div class="mdl-layout__tab-bar-button mdl-layout__tab-bar-left-button"><i class="material-icons">chevron_left</i></div><div class="mdl-layout--large-screen-only mdl-layout__tab-bar mdl-js-ripple-effect mdl-color--primary-dark mdl-color-text--white mdl-js-ripple-effect--ignore-events" data-upgraded=",MaterialRipple"><a class="mdl-layout__tab" href="https://cssicurriculum.withgoogle.com/intro.html">Intro<span class="mdl-layout__tab-ripple-container mdl-js-ripple-effect" data-upgraded=",MaterialRipple"><span class="mdl-ripple"></span></span></a><a class="mdl-layout__tab" href="https://cssicurriculum.withgoogle.com/command-line.html">Command Line<span class="mdl-layout__tab-ripple-container mdl-js-ripple-effect" data-upgraded=",MaterialRipple"><span class="mdl-ripple"></span></span></a><a class="mdl-layout__tab" href="https://cssicurriculum.withgoogle.com/html.html">HTML &amp; CSS<span class="mdl-layout__tab-ripple-container mdl-js-ripple-effect" data-upgraded=",MaterialRipple"><span class="mdl-ripple"></span></span></a><a class="mdl-layout__tab" href="https://cssicurriculum.withgoogle.com/javascript.html">JavaScript<span class="mdl-layout__tab-ripple-container mdl-js-ripple-effect" data-upgraded=",MaterialRipple"><span class="mdl-ripple"></span></span></a><a class="mdl-layout__tab" href="https://cssicurriculum.withgoogle.com/python.html">Python<span class="mdl-layout__tab-ripple-container mdl-js-ripple-effect" data-upgraded=",MaterialRipple"><span class="mdl-ripple"></span></span></a><a class="mdl-layout__tab is-active" href="https://cssicurriculum.withgoogle.com/app-engine.html">AppEngine<span class="mdl-layout__tab-ripple-container mdl-js-ripple-effect" data-upgraded=",MaterialRipple"><span class="mdl-ripple"></span></span></a><a class="mdl-layout__tab" href="https://cssicurriculum.withgoogle.com/project.html">Project Week<span class="mdl-layout__tab-ripple-container mdl-js-ripple-effect" data-upgraded=",MaterialRipple"><span class="mdl-ripple"></span></span></a><a class="mdl-layout__tab" href="https://cssicurriculum.withgoogle.com/git.html">Git<span class="mdl-layout__tab-ripple-container mdl-js-ripple-effect" data-upgraded=",MaterialRipple"><span class="mdl-ripple"></span></span></a><a class="mdl-layout__tab" href="https://cssicurriculum.withgoogle.com/resources.html">Resources<span class="mdl-layout__tab-ripple-container mdl-js-ripple-effect" data-upgraded=",MaterialRipple"><span class="mdl-ripple"></span></span></a></div><div class="mdl-layout__tab-bar-button mdl-layout__tab-bar-right-button"><i class="material-icons">chevron_right</i></div></div></header><div class="mdl-layout__drawer" aria-hidden="true"><span class="mdl-layout-title">CSSIx Modules</span><nav class="mdl-navigation"><a class="mdl-navigation__link" href="https://cssicurriculum.withgoogle.com/intro.html">Intro</a> <a class="mdl-navigation__link" href="https://cssicurriculum.withgoogle.com/command-line.html">Command Line</a> <a class="mdl-navigation__link" href="https://cssicurriculum.withgoogle.com/html.html">HTML &amp; CSS</a> <a class="mdl-navigation__link" href="https://cssicurriculum.withgoogle.com/javascript.html">JavaScript</a> <a class="mdl-navigation__link" href="https://cssicurriculum.withgoogle.com/python.html">Python</a> <a class="mdl-navigation__link is-active" href="https://cssicurriculum.withgoogle.com/app-engine.html">AppEngine</a> <a class="mdl-navigation__link" href="https://cssicurriculum.withgoogle.com/project.html">Project Week</a> <a class="mdl-navigation__link" href="https://cssicurriculum.withgoogle.com/git.html">Git</a> <a class="mdl-navigation__link" href="https://cssicurriculum.withgoogle.com/resources.html">Resources</a></nav></div><main class="mdl-layout__content cssi-main"><div class="mdl-grid"><div class="mdl-cell mdl-cell--2-col mdl-cell--hide-tablet mdl-cell--hide-phone"></div><div class="cssix-content mdl-color--white mdl-shadow--4dp content mdl-color-text--grey-800 mdl-cell mdl-cell--8-col"><div class="post"><header class="post-header"><div><div class="PageNavigation"><a class="prev" href="https://cssicurriculum.withgoogle.com/mvc-appEngine/app-engine-student-walkthrough-reference.html">« Google App Engine Reference</a> <a class="next" href="https://cssicurriculum.withgoogle.com/mvc-appEngine/datastore-landing-page.html">Datastore »</a></div></div></header><article class="post-content"><h1 id="google-app-engine-reference-2-with-forms">Google App Engine Reference 2 (with forms)</h1><h3 id="sequence">Sequence</h3><ol><li><a href="https://cssicurriculum.withgoogle.com/mvc-appEngine/app-engine-form-reference.html#context">Context</a></li><li><a href="https://cssicurriculum.withgoogle.com/mvc-appEngine/app-engine-form-reference.html#in-action">Google App Engine in Action</a><ol><li><a href="https://cssicurriculum.withgoogle.com/mvc-appEngine/app-engine-form-reference.html#file-structure">Finished File Structure</a></li><li><a href="https://cssicurriculum.withgoogle.com/mvc-appEngine/app-engine-form-reference.html#config-files">Configuration Files</a><ol><li><a href="https://cssicurriculum.withgoogle.com/mvc-appEngine/app-engine-form-reference.html#app-yaml">app.yaml: The Google App Engine Configuration File</a></li><li><a href="https://cssicurriculum.withgoogle.com/mvc-appEngine/app-engine-form-reference.html#main-py">main.py: The Controller File</a><ul><li><a href="https://cssicurriculum.withgoogle.com/mvc-appEngine/app-engine-form-reference.html#import-libraries">Import Libraries</a></li><li><a href="https://cssicurriculum.withgoogle.com/mvc-appEngine/app-engine-form-reference.html#define-handlers">Define Handlers</a></li><li><a href="https://cssicurriculum.withgoogle.com/mvc-appEngine/app-engine-form-reference.html#add-configuration">Add Configuration</a></li></ul></li></ol></li><li><a href="https://cssicurriculum.withgoogle.com/mvc-appEngine/app-engine-form-reference.html#jinja2">The jinja2 Library</a></li><li><a href="https://cssicurriculum.withgoogle.com/mvc-appEngine/app-engine-form-reference.html#getting-user-data">Getting User Data</a></li><li><a href="https://cssicurriculum.withgoogle.com/mvc-appEngine/app-engine-form-reference.html#launching-the-app">Launching the App</a></li><li><a href="https://cssicurriculum.withgoogle.com/mvc-appEngine/app-engine-form-reference.html#deploying-your-app">Deploying Your App</a></li></ol></li><li><a href="https://cssicurriculum.withgoogle.com/mvc-appEngine/app-engine-form-reference.html#tips">Tips &amp; Tricks</a></li><li><a href="https://cssicurriculum.withgoogle.com/mvc-appEngine/app-engine-form-reference.html#summary">Best Practices Summary</a></li></ol><h2 id="context"><a id="context"></a>Context</h2><p><strong>Google App Engine</strong> is a set of tools that will help you quickly build and deploy an app to the Google Cloud Platform. In the example below, you will use the <strong>Command Line</strong> to spin up an instance of the Google App Engine, the <strong>scripting</strong> language Python to code the behavior of your app, and templated <strong>HTML</strong> pages for your user interface.</p><h2 id="google-app-engine-in-action"><a id="context"></a>Google App Engine In Action</h2><p>Below is a completed Google App Engine App that includes a form. Let’s dissect what goes into the app so you can see how the pieces fit together.</p><h3 id="finished-file-structure"><a id="file-structure"></a>Finished File Structure</h3><p>The completed file structure of an app with a form will look something like (where additional files are denoted by <code class="highlighter-rouge"># new</code>):</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>my_app/
├ app.yaml
├ imagefinder.py <span class="c"># new</span>
├ imagefinder.pyc <span class="c"># new</span>
├ main.py
├ main.pyc
├ models.py <span class="c"># new</span>
├ models.pyc <span class="c"># new</span>
└ templates/
   ├ allMemes.html <span class="c"># new</span>
   ├ results.html <span class="c"># new</span>
   └ welcome.html

</pre></td></tr></tbody></table></code></pre></div></div><p>As before:</p><ul><li><code class="highlighter-rouge">app.yaml</code> is the app’s configuration file.</li><li><code class="highlighter-rouge">main.py</code> is a python file controls how the app should respond to user input.</li><li><code class="highlighter-rouge">templates/</code> is a folder that holds HTML files that a user will be routed to. These HTML files may act as templates where data will populate the content of the page.</li></ul><p>But we’ve added:</p><ul><li>Additional python files like <code class="highlighter-rouge">models.py</code> and <code class="highlighter-rouge">trackimage.py</code> may also be included which add additional functionality.</li><li>Additional HTML template files may be needed for additional views.</li></ul><p><strong>Note:</strong> As before, the compiled python files ending in <code class="highlighter-rouge">.pyc</code> are also shown.</p><h3 id="configuration-files"><a id="config-files"></a>Configuration Files</h3><h4 id="appyaml-the-google-app-engine-configuration-file"><a id="app-yaml"></a>app.yaml: The Google App Engine Configuration File</h4><p>The <code class="highlighter-rouge">app.yaml</code> file is unchanged from the version without a form.</p><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="c1">#app.yaml</span>
<span class="na">runtime</span><span class="pi">:</span> <span class="s">python27</span>
<span class="na">api_version</span><span class="pi">:</span> <span class="s">1</span>
<span class="na">threadsafe</span><span class="pi">:</span> <span class="no">true</span>

<span class="na">handlers</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">url</span><span class="pi">:</span> <span class="s">/.*</span>
  <span class="na">script</span><span class="pi">:</span> <span class="s">main.app</span>

<span class="na">libraries</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">jinja2</span>
  <span class="na">version</span><span class="pi">:</span> <span class="s">latest</span>
</pre></td></tr></tbody></table></code></pre></div></div><h4 id="mainpy-the-controller-file"><a id="main-py"></a>main.py: The Controller File</h4><p>In this version of <code class="highlighter-rouge">main.py</code>:</p><ul><li>three additional functions are imported (<code class="highlighter-rouge">from ... import ...</code>)</li><li>a new handler, <code class="highlighter-rouge">ShowMeme()</code> has been added that is described in the <a href="https://cssicurriculum.withgoogle.com/mvc-appEngine/app-engine-form-reference.html#getting-user-data">“Getting User Data”</a> section below</li><li>a new configuration is required for <code class="highlighter-rouge">ShowMeme</code> at <code class="highlighter-rouge">/showmeme</code></li></ul><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
</pre></td><td class="rouge-code"><pre><span class="c"># import libraries</span>
<span class="kn">import</span> <span class="nn">webapp2</span>
<span class="kn">import</span> <span class="nn">jinja2</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">imagefinder</span> <span class="kn">import</span> <span class="n">getimage</span> <span class="c"># new</span>
<span class="kn">from</span> <span class="nn">models</span> <span class="kn">import</span> <span class="n">Meme</span> <span class="c"># new</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span> <span class="c"># new</span>

<span class="c"># load jinja2 environment variable</span>
<span class="n">JINJA_ENVIRONMENT</span> <span class="o">=</span> <span class="n">jinja2</span><span class="o">.</span><span class="n">Environment</span><span class="p">(</span>
    <span class="n">loader</span><span class="o">=</span><span class="n">jinja2</span><span class="o">.</span><span class="n">FileSystemLoader</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">)),</span>
    <span class="n">extensions</span><span class="o">=</span><span class="p">[</span><span class="s">'jinja2.ext.autoescape'</span><span class="p">],</span>
    <span class="n">autoescape</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c"># define handlers</span>
<span class="k">class</span> <span class="nc">MainPage</span><span class="p">(</span><span class="n">webapp2</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">welcometemplate</span> <span class="o">=</span> <span class="n">JINJA_ENVIRONMENT</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s">'templates/welcome.html'</span><span class="p">)</span>
        <span class="n">myinfo</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">"greeting"</span> <span class="p">:</span> <span class="s">"SUP!"</span><span class="p">,</span>
            <span class="s">"adjective"</span> <span class="p">:</span> <span class="s">"rad"</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">welcometemplate</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">myinfo</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">SecretPage</span><span class="p">(</span><span class="n">webapp2</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s">'Content-Type'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'text/plain'</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">'You found the secret page'</span><span class="p">)</span>

<span class="c"># a new handler!</span>
<span class="k">class</span> <span class="nc">ShowMeme</span><span class="p">(</span><span class="n">webapp2</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">memestemplate</span> <span class="o">=</span> <span class="n">JINJA_ENVIRONMENT</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s">'templates/allMemes.html'</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">"memes"</span> <span class="p">:</span> <span class="n">Meme</span><span class="o">.</span><span class="n">query</span><span class="p">()</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="n">allMemes</span> <span class="o">=</span> <span class="n">Meme</span><span class="o">.</span><span class="n">query</span><span class="p">()</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">memestemplate</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resultstemplate</span> <span class="o">=</span> <span class="n">JINJA_ENVIRONMENT</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s">'templates/results.html'</span><span class="p">)</span>
        <span class="n">myMeme</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">"line1"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"line1"</span><span class="p">),</span>
            <span class="s">"line2"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"line2"</span><span class="p">),</span>
            <span class="s">"choice"</span><span class="p">:</span> <span class="n">getimage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"genre"</span><span class="p">)),</span>
            <span class="s">"author"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"username"</span><span class="p">),</span>
            <span class="s">"date"</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"date"</span><span class="p">),</span> <span class="s">'</span><span class="si">%</span><span class="s">Y-</span><span class="si">%</span><span class="s">m-</span><span class="si">%</span><span class="s">d'</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">myMeme</span><span class="o">.</span><span class="n">put</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">resultstemplate</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">myMeme</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">TestHandler</span><span class="p">(</span><span class="n">webapp2</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">"test passed!"</span><span class="p">)</span>

<span class="c"># add configuration</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">webapp2</span><span class="o">.</span><span class="n">WSGIApplication</span><span class="p">([</span>
    <span class="p">(</span><span class="s">'/'</span><span class="p">,</span> <span class="n">MainPage</span><span class="p">),</span>
    <span class="p">(</span><span class="s">'/showmeme'</span><span class="p">,</span> <span class="n">ShowMeme</span><span class="p">),</span> <span class="c"># new</span>
    <span class="p">(</span><span class="s">'/hello'</span><span class="p">,</span> <span class="n">SecretPage</span><span class="p">),</span>
    <span class="p">(</span><span class="s">'/test'</span><span class="p">,</span> <span class="n">TestHandler</span><span class="p">)</span>
<span class="p">],</span> <span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div><h5 id="import-libraries"><a id="import-libraries"></a>Import Libraries</h5><p>As before, the first block of text is where other code blocks called libraries are loaded so they can be used by the app.</p><p>In the example above, we’re loading the same libraries as before - <code class="highlighter-rouge">webapp2</code>, <code class="highlighter-rouge">jinja2</code>, and <code class="highlighter-rouge">os</code> - and we’re adding three new functions:</p><ul><li>a function called <code class="highlighter-rouge">getimage</code> from the file called <code class="highlighter-rouge">imagefinder</code></li><li>a function called <code class="highlighter-rouge">Meme</code> from the file called <code class="highlighter-rouge">models</code></li><li>a function called <code class="highlighter-rouge">datetime</code> from the library called <code class="highlighter-rouge">datetime</code></li></ul><h5 id="define-handlers"><a id="define-handlers"></a>Define Handlers</h5><p>As before, three handlers are defined - <code class="highlighter-rouge">MainPage</code>, <code class="highlighter-rouge">SecretPage</code>, and <code class="highlighter-rouge">TestHandler</code> - but now there is a new handler called <code class="highlighter-rouge">ShowMeme</code>:</p><ul><li><code class="highlighter-rouge">class ShowMeme</code> handles two requests: a <code class="highlighter-rouge">GET</code> request and a <code class="highlighter-rouge">POST</code> request:<ul><li>the result of a <code class="highlighter-rouge">GET</code> request is to load the <code class="highlighter-rouge">allMemes.html</code> template and populate it with stored memes.</li><li>the result of a <code class="highlighter-rouge">POST</code> request is to load the <code class="highlighter-rouge">results.html</code> template and populate it with the new (user-submitted) meme.</li></ul></li></ul><h5 id="add-configuration"><a id="add-configuration"></a>Add Configuration</h5><p>As before, three URLs are handled in the configuration - <code class="highlighter-rouge">/</code>, <code class="highlighter-rouge">/hello</code>, and <code class="highlighter-rouge">/test</code> - but now a new URL has been added:</p><ul><li>The URL <code class="highlighter-rouge">/showmeme</code> should run the <code class="highlighter-rouge">ShowMeme</code> handler.</li></ul><p>Don’t forget to consult the <a href="https://cloud.google.com/appengine/docs/standard/python/quickstart">Google App Engine Documentation</a>. Try to search for this documentation by using search terms like <em>“Google App Engine Hello World Webapp2”</em>.</p><h3 id="the-jinja2-library"><a id="jinja2"></a>The jinja2 Library</h3><p>As before, we load the jinja2 environment variable that is necessary for the app to correctly render HTML files that use <code class="highlighter-rouge">jinja</code> templating:</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="n">JINJA_ENVIRONMENT</span> <span class="o">=</span> <span class="n">jinja2</span><span class="o">.</span><span class="n">Environment</span><span class="p">(</span>
    <span class="n">loader</span><span class="o">=</span><span class="n">jinja2</span><span class="o">.</span><span class="n">FileSystemLoader</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">)),</span>
    <span class="n">extensions</span><span class="o">=</span><span class="p">[</span><span class="s">'jinja2.ext.autoescape'</span><span class="p">],</span>
    <span class="n">autoescape</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div><p><strong>Note:</strong> As before, the environment variable uses the current operating system’s path, which is why we also have to import the <code class="highlighter-rouge">os</code> libray at the beginning of <code class="highlighter-rouge">main.py</code>.</p><p>More information about this can be found in the <a href="https://cloud.google.com/appengine/docs/standard/python/getting-started/generating-dynamic-content-templates">Google App Engine Documentation</a>. To find it, use search terms like “jinja environment variable GAE.”</p><h3 id="getting-user-data"><a id="getting-user-data"></a>Getting User Data</h3><p>Now we also want to collect data from a user and show that data back to the user in a response.</p><p>To get user data, build a <code class="highlighter-rouge">&lt;form&gt;</code> that uses the <code class="highlighter-rouge">POST</code> method to send the data back to your app. The form’s <code class="highlighter-rouge">action</code> attribute can be used to redirect the request to a new route.</p><p><code class="highlighter-rouge">welcome.html</code> has been updated below to include a <code class="highlighter-rouge">&lt;form&gt;</code> that collects the following data; look for the <code class="highlighter-rouge">name</code> attribute of the <code class="highlighter-rouge">&lt;input&gt;</code> fields and <code class="highlighter-rouge">&lt;option&gt;</code> fields:</p><ul><li><code class="highlighter-rouge">line1</code></li><li><code class="highlighter-rouge">line2</code></li><li><code class="highlighter-rouge">genre</code></li><li><code class="highlighter-rouge">username</code></li><li><code class="highlighter-rouge">date</code></li></ul><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span> <span class="na">dir=</span><span class="s">"ltr"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Welcome to the Meme Generator!<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;h3&gt;&lt;/h3&gt;</span>
    <span class="nt">&lt;h4&gt;</span>Hope you're having a  day!<span class="nt">&lt;/h4&gt;</span>
    <span class="c">&lt;!-- a new form! --&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">class=</span><span class="s">""</span> <span class="na">action=</span><span class="s">"/showmeme"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"line1"</span> <span class="na">value=</span><span class="s">"first line"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"line2"</span> <span class="na">value=</span><span class="s">"second line"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;select</span> <span class="na">class=</span><span class="s">""</span> <span class="na">name=</span><span class="s">"genre"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"pop"</span><span class="nt">&gt;</span>Pop culture<span class="nt">&lt;/option&gt;</span>
        <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"pug"</span><span class="nt">&gt;</span>Animal<span class="nt">&lt;/option&gt;</span>
        <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"dragrace"</span><span class="nt">&gt;</span>Drag<span class="nt">&lt;/option&gt;</span>
      <span class="nt">&lt;/select&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"username"</span> <span class="na">value=</span><span class="s">"Your name"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"date"</span> <span class="na">name=</span><span class="s">"date"</span> <span class="na">value=</span><span class="s">""</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">name=</span><span class="s">""</span> <span class="na">value=</span><span class="s">"Send!"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div><p>To access the data in the form, pass the <code class="highlighter-rouge">name</code> attribute of the <code class="highlighter-rouge">&lt;input&gt;</code> you want to use to the <code class="highlighter-rouge">self.request.get()</code> method in the data object of a handler.</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">ShowMeme</span><span class="p">(</span><span class="n">webapp2</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="c"># show all memes in the allMemes.html template</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">memestemplate</span> <span class="o">=</span> <span class="n">JINJA_ENVIRONMENT</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s">'templates/allMemes.html'</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">"memes"</span> <span class="p">:</span> <span class="n">Meme</span><span class="o">.</span><span class="n">query</span><span class="p">()</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="n">allMemes</span> <span class="o">=</span> <span class="n">Meme</span><span class="o">.</span><span class="n">query</span><span class="p">()</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">memestemplate</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="c"># show the new meme in the results.html template</span>
    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resultstemplate</span> <span class="o">=</span> <span class="n">JINJA_ENVIRONMENT</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s">'templates/results.html'</span><span class="p">)</span>
        <span class="c"># collect data from the form</span>
        <span class="n">myMeme</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">"line1"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"line1"</span><span class="p">),</span>
            <span class="s">"line2"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"line2"</span><span class="p">),</span>
            <span class="c"># the getimage() function imported from imagefinder</span>
            <span class="s">"choice"</span><span class="p">:</span> <span class="n">getimage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"genre"</span><span class="p">)),</span>
            <span class="s">"author"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"username"</span><span class="p">),</span>
            <span class="c"># the datetime() function imported from datetime</span>
            <span class="s">"date"</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"date"</span><span class="p">),</span> <span class="s">'</span><span class="si">%</span><span class="s">Y-</span><span class="si">%</span><span class="s">m-</span><span class="si">%</span><span class="s">d'</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="c"># add this new meme to the datastore</span>
        <span class="n">myMeme</span><span class="o">.</span><span class="n">put</span><span class="p">()</span>
        <span class="c"># show the data on results.html</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">resultstemplate</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">myMeme</span><span class="p">))</span>
</pre></td></tr></tbody></table></code></pre></div></div><p>For example, the code above will use the value of the <code class="highlighter-rouge">&lt;input&gt;</code> with the name <code class="highlighter-rouge">line1</code> as a property called <code class="highlighter-rouge">line1</code> in the <code class="highlighter-rouge">myMeme</code> object. The value of <code class="highlighter-rouge">line1</code> will then be sent as part of the data to the <code class="highlighter-rouge">results.html</code> templated page via <code class="highlighter-rouge">self.response.write(resultstemplate.render(myMeme))</code>.</p><p><strong>Note:</strong> the data is also added to the datastore via <code class="highlighter-rouge">myMeme.put()</code>. For more information, check the Google Datastore Reference.</p><p>The <code class="highlighter-rouge">results.html</code> template shows the new entry back to the user, using the jinja2 library to substitute the data from the <code class="highlighter-rouge">myMeme</code> JSON object above:</p><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span> <span class="na">dir=</span><span class="s">"ltr"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Your meme!<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"memecard"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h3&gt;&lt;/h3&gt;</span>
      <span class="nt">&lt;h3&gt;&lt;/h3&gt;</span>
      <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">""</span> <span class="na">alt=</span><span class="s">""</span><span class="nt">&gt;</span>
      <span class="nt">&lt;p&gt;</span>created by  on <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div><h3 id="launching-the-app"><a id="launching-the-app"></a>Launching the App</h3><p>As before, launch the app using the command line by running the <code class="highlighter-rouge">dev_appserver.py app.yaml</code> and view it at ‘localhost:8080’.</p><h3 id="deploying-your-app"><a id="deploying-your-app"></a>Deploying Your App</h3><p>As before, deploy your app to the cloud by including your unique project id after the <code class="highlighter-rouge">--project</code> flag.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>gcloud app deploy app.yaml <span class="nt">--project</span> <span class="o">[</span>STUDENT_PROJECT_ID]
</pre></td></tr></tbody></table></code></pre></div></div><p>Load your app on the cloud by going to <code class="highlighter-rouge">http://[STUDENT__PROJECT_ID].appspot.com</code>.</p><h2 id="tips--tricks"><a id="tips"></a>Tips &amp; Tricks</h2><ul><li>Get in the habit of using developer documentation to find answers to your questions, e.g.:<ul><li><a href="https://cloud.google.com/appengine/docs/standard/python/quickstart">Google App Engine Documentation</a></li></ul></li></ul><h2 id="best-practices-summary"><a id="summary"></a>Best Practices Summary</h2><ul><li>Iteratively build upon a working app. It’s best to start with the basics and make changes/updates/improvements/tweaks as you go. Notice how the complexity is not necessarily introduced at the beginning, but instead it develops by adding on new functionality.</li><li>Use a new handler for each new endpoint you create.</li><li>Use the <code class="highlighter-rouge">self.request.get()</code> method to access data in forms.</li><li>Test your app often to make sure you account for all possibilities of how it might be used, especially when collecting, storing, and using data.</li><li>Deploy your app to the Google Cloud using<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>gcloud app deploy app.yaml <span class="nt">--project</span> <span class="o">[</span>STUDENT_PROJECT_ID]
</pre></td></tr></tbody></table></code></pre></div></div><p>then view it at <code class="highlighter-rouge">http://[STUDENT__PROJECT_ID].appspot.com</code>.</p></li></ul></article><footer class="post-footer"><hr><div class="PageNavigation"><a class="prev" href="https://cssicurriculum.withgoogle.com/mvc-appEngine/app-engine-student-walkthrough-reference.html">« Google App Engine Reference</a> <a class="next" href="https://cssicurriculum.withgoogle.com/mvc-appEngine/datastore-landing-page.html">Datastore »</a></div></footer></div></div></div></main><footer class="mdl-mini-footer section"><div class="mdl-mini-footer__left-section"><div class="lockup va"><span class="lockup-logo lockup-dark"></span></div></div><div class="mdl-mini-footer__right-section"><ul class="mdl-mini-footer__link-list"><li><span id="site_label">CSSI - Atlanta</span></li><li>--</li><li><a href="https://www.google.com/intl/en/about/">About Google</a></li><li><a href="https://www.google.com/intl/en/policies/privacy/">Privacy</a></li><li><a href="https://www.google.com/intl/en/policies/terms/">Terms</a></li><li><a href="https://cssicurriculum.withgoogle.com/mvc-appEngine/app-engine-form-reference.html#" id="signout_link">Logout</a></li><li><a href="https://cssicurriculum.withgoogle.com/mvc-appEngine/app-engine-form-reference.html#" id="forgetme_link">Forget Me</a></li></ul></div><script src="./Google App Engine Reference 2 (with forms)_files/firebase-app.js.download"></script><script src="./Google App Engine Reference 2 (with forms)_files/firebase-auth.js.download"></script><script src="./Google App Engine Reference 2 (with forms)_files/firebaseui.js.download"></script><link href="./Google App Engine Reference 2 (with forms)_files/firebaseui.css" rel="stylesheet" type="text/css"><script>
  function getCookie(name) {
    let dc = document.cookie;
    let prefix = name + "=";
    let begin = dc.indexOf("; " + prefix);
    if (begin == -1) {
      begin = dc.indexOf(prefix);
      if (begin != 0) return null;
    }
    begin += 2;
    let end = document.cookie.indexOf(";", begin);
    if (end == -1) {
      end = dc.length;
    }
    return decodeURI(dc.substring(begin + prefix.length, end));
  }

  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyD_NpvZGlms1zebBgfE4RZPCim5irYGbG4",
    authDomain: "cssi-curriculum.firebaseapp.com",
    databaseURL: "https://cssi-curriculum.firebaseio.com",
    projectId: "cssi-curriculum",
    storageBucket: "cssi-curriculum.appspot.com",
    messagingSenderId: "443846997353"
  };
  // Firebase log-in widget
  function configureFirebaseLoginWidget() {
    let uiConfig = {
      signInSuccessUrl: '/',
      signInOptions: [
        // Leave the lines as is for the providers you want to offer your users.
        firebase.auth.GoogleAuthProvider.PROVIDER_ID,
        {
            provider: firebase.auth.EmailAuthProvider.PROVIDER_ID,
            // Whether the display name should be displayed in the Sign Up page.
            requireDisplayName: false,
        },
      ],
      callbacks: {
        signInSuccessWithAuthResult: function(authResult, redirectUrl) {
          let user = authResult.user;
          let credential = authResult.credential;
          let isNewUser = authResult.additionalUserInfo.isNewUser;
          let providerId = authResult.additionalUserInfo.providerId;
          let operationType = authResult.operationType;
          // Do something with the returned AuthResult.
          // Return type determines whether we continue the redirect automatically
          // or whether we leave that to developer to handle.
          return true;
        },
        signInFailure: function(error) {
          // Some unrecoverable error occurred during sign-in.
          // Return a promise when error handling is completed and FirebaseUI
          // will reset, clearing any UI. This commonly occurs for error code
          // 'firebaseui/anonymous-upgrade-merge-conflict' when merge conflict
          // occurs. Check below for more details on this.
          return handleUIError(error);
        },
      },
      // Terms of service url
      'tosUrl': 'https://www.google.com/intl/en/policies/terms/',
    };

    let user = firebase.auth().currentUser;
    if (!user && document.getElementById('firebaseui-auth-container')) {
      let ui = new firebaseui.auth.AuthUI(firebase.auth());
      ui.start('#firebaseui-auth-container', uiConfig);
    }
  }

  function updateUserToken(user) {
    let oldCookie = getCookie('idToken');
    if (user) {
      let refresh_token = getCookie('needRefreshToken');
      user.getIdToken(refresh_token == 'true').then(function(idToken) {
        document.cookie = "idToken=" + idToken + "; path=/";
        if (!oldCookie) {
          location.reload();
        }
      });
    } else {
      console.log("Removing auth token");
      document.cookie = "idToken=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC";
      if (oldCookie) {
        location.reload();
      }
    }
  }

  function configureFirebaseLogin() {
    firebase.initializeApp(config);
    firebase.auth().onAuthStateChanged(updateUserToken);
    firebase.auth().onIdTokenChanged(function() {console.log("token changed");});
  }

  function signOut() {
    firebase.auth().signOut();
    window.location = "/";
    return false;
  }

  function forgetMe() {
    let user = firebase.auth().currentUser;
    user.delete().then(function() {
      console.log("User deleted");
    }).catch(function(error) {
      console.log("Error deleting the user " + error);
    });
    firebase.auth().signOut();
    window.location = "/";
    return false;
  }

  function sendVerificationEmail() {
    let user = firebase.auth().currentUser;
    if (user && !user.emailVerified) {
      user.sendEmailVerification().then(function() {
          console.log("Verification email sent.");
        }).catch(function(error) {
          console.log("An error happened while sending the verification email.");
        });
    } else if (user) {
      console.log("Email already verified");
    } else {
      console.log("User not logged in");
    }
    console.log("Removing auth token");
    document.cookie = "idToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC";
    document.querySelector('#send_verification_button').style.display = 'None';
    document.querySelector('#verification_sent').style.display = 'block';
  }

  function checkAndRestoreCookie(){
    let user = firebase.auth().currentUser;
  }

  function showAnswer(event) {
    let show_answer_button = event.currentTarget;
    let answer_container = show_answer_button.parentElement;
    toggleAnswer(answer_container, true);
  }

  function hideAnswer(event) {
    let show_answer_button = event.currentTarget;
    let answer_container = show_answer_button.parentElement;
    toggleAnswer(answer_container, false);
  }

  function toggleAnswer(container, visible) {
    let answer = container.querySelector('.answer');
    answer.style.display = visible ? 'block' : 'none';
    let hide_answer_button = container.querySelector('.hide_answer');
    hide_answer_button.style.display = visible ? 'block' : 'none';
    let show_answer_button = container.querySelector('.show_answer');
    show_answer_button.style.display = visible ? 'none' : 'block';
  }

  function toggleStudentViewCookie(event) {
    const new_value = event.target.checked;
    document.cookie = "student_view=" + new_value + ";path=/";
    location.reload();
  }

  window.addEventListener('load', function() {
    configureFirebaseLogin();
    configureFirebaseLoginWidget();
    //checkAndRestoreCookie();
    let signout_link = document.querySelector('#signout_link');
    if (signout_link) {
      signout_link.onclick = signOut;
    }
    let forgetme_link = document.querySelector('#forgetme_link');
    if (forgetme_link) {
      forgetme_link.onclick = forgetMe;
    }
    let email_verification_btn = document.querySelector('#send_verification_button');
    if (email_verification_btn) {
      email_verification_btn.onclick = sendVerificationEmail;
    }
    let show_answer_btns = document.querySelectorAll('.show_answer');
    show_answer_btns.forEach( function(element) {
      element.onclick = showAnswer;
    });
    let hide_answer_btns = document.querySelectorAll('.hide_answer');
    hide_answer_btns.forEach( function(element) {
      element.onclick = hideAnswer;
    });
    // Student View checkbox not available on all pages, if present,
    // it can be used to override the user role, so that instructors can view
    // content as students.
    let student_view_flag = document.querySelector('#chk_student_view');
    if (student_view_flag) {
      student_view_flag.checked = JSON.parse(getCookie('student_view'));
      student_view_flag.onclick = toggleStudentViewCookie;
    }
    // Select the proper element in the site selection view based on the
    // existing cookies.
    let selected_site = getCookie('site');
    let site_selector_list = document.querySelectorAll('.site_radio');
    [].forEach.call(site_selector_list, (element) => {
      element.addEventListener('click', () => {
        console.log('Clicked ' + element.value);
        document.cookie = "site=" + element.value + ";path=/";
        document.querySelector('#site_label').innerText = element.dataset.label;
      });
    });
    if (selected_site && site_selector_list.length > 0) {
      [].forEach.call(site_selector_list, (element) => {
        console.log(selected_site);
        if (element.value === selected_site) {
          element.checked = true;
        } else {
          element.checked = false;
        }
      });
      console.log(site_selector_list);
    }

  })
</script><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-101261509-1', 'auto');
  ga('send', 'pageview');
</script></footer><div class="mdl-layout__obfuscator"></div></div></div></body></html>