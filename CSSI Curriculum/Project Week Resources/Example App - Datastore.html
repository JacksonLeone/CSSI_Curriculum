<!DOCTYPE html>
<!-- saved from url=(0075)https://cssicurriculum.withgoogle.com/B-Project-week/datastore_example.html -->
<html class="gr__cssicurriculum_withgoogle_com mdl-js"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta content="IE=edge" http-equiv="X-UA-Compatible"><meta content="width=device-width, initial-scale=1" name="viewport"><title>Example App - Datastore</title><meta content="
          
              Example App: Datastore
          " name="description"><link href="https://cssicurriculum.withgoogle.com/favicon.ico" rel="shortcut icon"><link href="./Example App - Datastore_files/material.indigo-yellow.min.css" rel="stylesheet"><link href="./Example App - Datastore_files/icon" rel="stylesheet"><script async="" src="./Example App - Datastore_files/analytics.js.download"></script><script defer="" src="./Example App - Datastore_files/material.min.js.download"></script><style>html,body{font-family:'Roboto','Helvetica',sans-serif;margin:0;padding:0}#verification_sent{display:None}.cssix-intro.mdl-card{width:99%;margin-bottom:2em}.cssix-intro.mdl-card>.mdl-card__supporting_text{padding:1em}.mdl-layout__header-row h3 a{color:white;text-decoration:none}#cssilogo_header{content:url('/cssilogo.png');width:80%}.admin_nav_link{color:red}.mdl-cssix .mdl-layout__header-row{padding-left:40px}.mdl-cssix .mdl-layout.is-small-screen .mdl-layout__header-row h3{font-size:inherit;padding-left:12px}.mdl-cssix .mdl-layout__tab-bar-button{display:none}.mdl-cssix .mdl-layout.is-small-screen .mdl-layout__tab-bar .mdl-button{display:none}.mdl-cssix .mdl-layout:not(.is-small-screen) .mdl-layout__tab-bar,.mdl-cssix .mdl-layout:not(.is-small-screen) .mdl-layout__tab-bar-container{overflow:visible}.cssi-main{overflow-x:visible!important;overflow-y:visible!important;overflow:visible!important}.mdl-cssix .mdl-layout__tab-bar-container{height:64px}.mdl-cssix .mdl-layout__tab-bar{padding:0;padding-left:16px;box-sizing:border-box;height:100%;width:100%}.mdl-cssix .mdl-layout__tab-bar .mdl-layout__tab{height:64px;line-height:64px;color:white}.mdl-cssix .mdl-layout__tab-bar .mdl-layout__tab.is-active::after{height:4px}.mdl-cssix main>.mdl-layout__tab-panel{padding:8px;padding-top:48px}.mdl-layout__tab#header_logout{background-color:red}.mdl-cssix .mdl-card{height:auto;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column}.mdl-cssix .mdl-card>*{height:auto}.mdl-cssix .mdl-card .mdl-card__supporting-text{margin:40px;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;padding:0;color:inherit;width:calc(100% - 80px)}.mdl-cssix .mdl-card__supporting-text h4{margin-top:0;margin-bottom:20px}.mdl-cssix .mdl-card__actions{margin:0;padding:4px 40px;color:inherit}.mdl-cssix .mdl-card__actions a{color:#00BCD4;margin:0}.mdl-cssix .mdl-card__actions a:hover,.mdl-cssix .mdl-card__actions a:active{color:inherit;background-color:transparent}.mdl-cssix .mdl-card__supporting-text+.mdl-card__actions{border-top:1px solid rgba(0,0,0,0.12)}.mdl-cssix #add{position:absolute;right:40px;top:36px;z-index:999}.mdl-list__item{min-height:.4em;padding:.3em}.material-icons.md-18{font-size:18px}.material-icons.md-24{font-size:24px}.material-icons.md-36{font-size:36px}.material-icons.md-48{font-size:48px}.post-list .toc_icon{vertical-align:middle;margin:.1em 1em}.mdl-cssix .mdl-layout__content section:not(:last-of-type){position:relative;margin-bottom:48px}.mdl-cssix section.section--center{max-width:860px}.mdl-cssix #features section.section--center{max-width:620px}.mdl-cssix section>header{display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-ms-flex-align:center;align-items:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center}.mdl-cssix section>.section__play-btn{min-height:200px}.mdl-cssix section>header>.material-icons{font-size:3rem}.mdl-cssix section>button{position:absolute;z-index:99;top:8px;right:8px}.mdl-cssix section .section__circle{display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-ms-flex-align:center;align-items:center;-webkit-justify-content:flex-start;-ms-flex-pack:start;justify-content:flex-start;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-shrink:1;-ms-flex-negative:1;flex-shrink:1}.mdl-cssix section .section__text{-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;padding-top:8px}.mdl-cssix section .section__text h5{font-size:inherit;margin:0;margin-bottom:.5em}.mdl-cssix section .section__text a{text-decoration:none}.mdl-cssix section .section__circle-container>.section__circle-container__circle{width:64px;height:64px;border-radius:32px;margin:8px 0}.mdl-cssix section.section--footer .section__circle--big{width:100px;height:100px;border-radius:50px;margin:8px 32px}.mdl-cssix .is-small-screen section.section--footer .section__circle--big{width:50px;height:50px;border-radius:25px;margin:8px 16px}.mdl-cssix section.section--footer{padding:64px 0;margin:0 -8px -8px -8px}.mdl-cssix section.section--center .section__text:not(:last-child){border-bottom:1px solid rgba(0,0,0,.13)}.mdl-cssix .mdl-card .mdl-card__supporting-text>h3:first-child{margin-bottom:24px}.mdl-cssix .mdl-layout__tab-panel:not(#overview){background-color:white}.mdl-cssix #features section{margin-bottom:72px}.mdl-cssix #features h4,#features h5{margin-bottom:16px}.mdl-cssix .toc{border-left:4px solid #C1EEF4;margin:24px;padding:0;padding-left:8px;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column}.mdl-cssix .toc h4{font-size:.9rem;margin-top:0}.mdl-cssix .toc a{color:#4DD0E1;text-decoration:none;font-size:16px;line-height:28px;display:block}.mdl-cssix .mdl-menu__container{z-index:99}.cssix-content{border-radius:2px;padding:80px 56px;margin-bottom:16px}.is-small-screen .cssix-content{padding:0 8px 16px 12px}.cssix-content a{color:#03a9f4!important}div.instructor{border:2px solid red;border-radius:12px;padding:10px}div.instructor::before{content:"Instructor Notes(The students will not see this content):";display:block;color:red;font-weight:bold}a.instructor-notes-link{color:green!important}div.unpublished{border:2px solid green;border-radius:12px;padding:10px;background-color:#deffd1}div.unpublished::before{content:"This content is not released to students yet";color:red;font-weight:bold}a.unpublished-link{color:red!important}a.next{float:right}.post-content img{width:50%;display:block;margin:auto}.post-content img.large_img{width:80%;display:block;margin:auto}.is-small-screen .mdl-layout__tab-bar-container{display:none}.mdl-layout.is-upgraded .mdl-layout__tab.is-active{color:yellow;font-weight:bold}.mdl-layout__tab.admin_link{background-color:#c71414}.mdl-layout__header .mdl-layout__drawer-button{color:yellow!important}. .mdl-mini-footer{border-top:1px solid #ccc;background-color:inherit!important;padding:8px 16px}footer .lockup{padding-left:15px;padding-top:10px}.lockup-logo,.lockup-text{display:inline-block}.va{vertical-align:middle;line-height:0}.lockup-logo{width:74px;height:24px;background-image:url(https://www.gstatic.com/images/branding/googlelogo/1x/googlelogo_color_74x24dp.png);background-size:74px 24px}.lockup-logo.lockup-dark{background-image:url(https://www.gstatic.com/images/branding/googlelogo/1x/googlelogo_dark_color_74x24dp.png);opacity:.54}@media(max-width:760px){footer .lockup{padding-top:0}}.answer{display:none;border:2px solid green;border-radius:12px;padding:1em}.hide_answer.mdl-button.mdl-js-button{display:none;!important}body,h1,h2,h3,h4,h5,h6,p,blockquote,pre,hr,dl,dd,ol,ul,figure{margin:0;padding:0}body{font-family:Helvetica,Arial,sans-serif;font-size:16px;line-height:1.5;font-weight:300;color:#111;background-color:yellow;-webkit-text-size-adjust:100%}h1,h2,h3,h4,h5,h6,p,blockquote,pre,ul,ol,dl,figure,.highlight{margin-bottom:15px}img{max-width:100%;vertical-align:middle;display:block}figure>img{display:block}figcaption{font-size:14px}ul,ol{margin-left:30px}li>ul,li>ol{margin-bottom:0}h1,h2,h3,h4,h5,h6{font-weight:300}a{color:#2a7ae2;text-decoration:none}a:visited{color:#1756a9}a:hover{color:#111;text-decoration:underline}blockquote{color:#828282;border-left:4px solid #e8e8e8;padding-left:15px;font-size:18px;letter-spacing:-1px;font-style:italic}blockquote>:last-child{margin-bottom:0}pre,code{font-size:15px;border:1px solid #e8e8e8;border-radius:3px;background-color:#eef}code{padding:1px 5px}pre{padding:8px 12px;overflow-x:scroll}pre>code{border:0;padding-right:0;padding-left:0}.wrapper{max-width:-webkit-calc(800px -(30px * 2));max-width:calc(800px -(30px * 2));margin-right:auto;margin-left:auto;padding-right:30px;padding-left:30px}@media screen and (max-width:800px){.wrapper{max-width:-webkit-calc(800px -(30px));max-width:calc(800px -(30px));padding-right:15px;padding-left:15px}}.wrapper:after,.footer-col-wrapper:after{content:"";display:table;clear:both}.icon>svg{display:inline-block;width:16px;height:16px;vertical-align:middle}.icon>svg path{fill:#828282}.site-header{border-top:5px solid #424242;border-bottom:1px solid #e8e8e8;min-height:56px;position:relative}.site-title{font-size:26px;line-height:56px;letter-spacing:-1px;margin-bottom:0;float:left}.site-title,.site-title:visited{color:#424242}.sidebar-nav{float:left;border-right:1px solid #e8e8e8}.site-nav{float:right;line-height:56px}.site-nav .menu-icon{display:none}.site-nav .page-link{color:#111;line-height:1.5}.site-nav .page-link:not(:first-child){margin-left:20px}@media screen and (max-width:600px){.site-nav{position:absolute;top:9px;right:30px;background-color:yellow;border:1px solid #e8e8e8;border-radius:5px;text-align:right}.site-nav .menu-icon{display:block;float:right;width:36px;height:26px;line-height:0;padding-top:10px;text-align:center}.site-nav .menu-icon>svg{width:18px;height:15px}.site-nav .menu-icon>svg path{fill:#424242}.site-nav .trigger{clear:both;display:none}.site-nav:hover .trigger{display:block;padding-bottom:5px}.site-nav .page-link{display:block;padding:5px 10px}}.site-footer{border-top:1px solid #e8e8e8;padding:30px 0}.footer-heading{font-size:18px;margin-bottom:15px}.contact-list,.social-media-list{list-style:none;margin-left:0}.footer-col-wrapper{font-size:15px;color:#828282;margin-left:-15px}.footer-col{float:left;margin-bottom:15px;padding-left:15px}.footer-col-1{width:-webkit-calc(35% -(30px / 2));width:calc(35% -(30px / 2))}.footer-col-2{width:-webkit-calc(20% -(30px / 2));width:calc(20% -(30px / 2))}.footer-col-3{width:-webkit-calc(45% -(30px / 2));width:calc(45% -(30px / 2))}@media screen and (max-width:800px){.footer-col-1,.footer-col-2{width:-webkit-calc(50% -(30px / 2));width:calc(50% -(30px / 2))}.footer-col-3{width:-webkit-calc(100% -(30px / 2));width:calc(100% -(30px / 2))}}@media screen and (max-width:600px){.footer-col{float:none;width:-webkit-calc(100% -(30px / 2));width:calc(100% -(30px / 2))}}.page-content{padding:30px 0}.page-heading{font-size:20px}.post-list{margin-left:0;list-style:none;display:block;flex-wrap:wrap;justify-content:flex-start}.post-list>li{flex-basis:50%}.post-meta{font-size:14px;color:#828282}.post-link{display:block;font-size:1em}.post-header,.post-footer{margin-bottom:30px}.cssi-post-title{font-size:42px;letter-spacing:-1px;line-height:1}@media screen and (max-width:800px){.cssi-post-title{font-size:36px}}.cssix-intro h1{font-size:24px;line-height:1}.cssix-intro h2{font-size:16px;line-height:1}.post-content{margin-bottom:30px}.post-content h2{font-size:32px}@media screen and (max-width:800px){.post-content h2{font-size:28px}}.post-content h3{font-size:26px}@media screen and (max-width:800px){.post-content h3{font-size:22px}}.post-content h4{font-size:20px}@media screen and (max-width:800px){.post-content h4{font-size:18px}}.PageNavigation{font-size:14px;display:block;width:auto;overflow:hidden}.PageNavigation a{display:block;width:50%;float:left;margin:1em 0}.PageNavigation .next{text-align:right}.highlight .c{color:#998;font-style:italic}.highlight .err{color:#a61717;background-color:#e3d2d2}.highlight .k{font-weight:bold}.highlight .o{font-weight:bold}.highlight .cm{color:#998;font-style:italic}.highlight .cp{color:#999;font-weight:bold}.highlight .c1{color:#998;font-style:italic}.highlight .cs{color:#999;font-weight:bold;font-style:italic}.highlight .gd{color:#000;background-color:#fdd}.highlight .gd .x{color:#000;background-color:#faa}.highlight .ge{font-style:italic}.highlight .gr{color:#a00}.highlight .gh{color:#999}.highlight .gi{color:#000;background-color:#dfd}.highlight .gi .x{color:#000;background-color:#afa}.highlight .go{color:#888}.highlight .gp{color:#555}.highlight .gs{font-weight:bold}.highlight .gu{color:#aaa}.highlight .gt{color:#a00}.highlight .kc{font-weight:bold}.highlight .kd{font-weight:bold}.highlight .kp{font-weight:bold}.highlight .kr{font-weight:bold}.highlight .kt{color:#458;font-weight:bold}.highlight .m{color:#099}.highlight .s{color:#d14}.highlight .na{color:#008080}.highlight .nb{color:#0086B3}.highlight .nc{color:#458;font-weight:bold}.highlight .no{color:#008080}.highlight .ni{color:#800080}.highlight .ne{color:#900;font-weight:bold}.highlight .nf{color:#900;font-weight:bold}.highlight .nn{color:#555}.highlight .nt{color:#000080}.highlight .nv{color:#008080}.highlight .ow{font-weight:bold}.highlight .w{color:#bbb}.highlight .mf{color:#099}.highlight .mh{color:#099}.highlight .mi{color:#099}.highlight .mo{color:#099}.highlight .sb{color:#d14}.highlight .sc{color:#d14}.highlight .sd{color:#d14}.highlight .s2{color:#d14}.highlight .se{color:#d14}.highlight .sh{color:#d14}.highlight .si{color:#d14}.highlight .sx{color:#d14}.highlight .sr{color:#009926}.highlight .s1{color:#d14}.highlight .ss{color:#990073}.highlight .bp{color:#999}.highlight .vc{color:#008080}.highlight .vg{color:#008080}.highlight .vi{color:#008080}.highlight .il{color:#099}</style><link href="http://cssicurriculum.withgoogle.com/B-Project-week/datastore_example.html" rel="canonical"><link href="http://cssicurriculum.withgoogle.com/feed.xml" rel="alternate" title="Google CSSI" type="application/rss+xml"></head><body class="mdl-color--grey-100 mdl-color-text--grey-700 mdl-cssix" data-gr-c-s-loaded="true"><div class="mdl-layout__container has-scrolling-header"><div class="mdl-layout mdl-js-layout mdl-layout--fixed-header mdl-layout--no-desktop-drawer-button has-drawer is-small-screen has-tabs is-upgraded" data-upgraded=",MaterialLayout"><header class="mdl-layout__header mdl-layout__header--scroll mdl-color--primary mdl-color-text--white"><div aria-expanded="false" role="button" tabindex="0" class="mdl-layout__drawer-button"><i class="material-icons"></i></div><div class="mdl-layout--large-screen-only mdl-layout__header-row"></div><div class="mdl-layout__header-row"><a href="https://cssicurriculum.withgoogle.com/" id="cssilogo_header"></a></div><div class="mdl-layout--large-screen-only mdl-layout__header-row"></div><div class="mdl-layout__tab-bar-container"><div class="mdl-layout__tab-bar-button mdl-layout__tab-bar-left-button"><i class="material-icons">chevron_left</i></div><div class="mdl-layout--large-screen-only mdl-layout__tab-bar mdl-js-ripple-effect mdl-color--primary-dark mdl-color-text--white mdl-js-ripple-effect--ignore-events" data-upgraded=",MaterialRipple"><a class="mdl-layout__tab" href="https://cssicurriculum.withgoogle.com/intro.html">Intro<span class="mdl-layout__tab-ripple-container mdl-js-ripple-effect" data-upgraded=",MaterialRipple"><span class="mdl-ripple"></span></span></a><a class="mdl-layout__tab" href="https://cssicurriculum.withgoogle.com/command-line.html">Command Line<span class="mdl-layout__tab-ripple-container mdl-js-ripple-effect" data-upgraded=",MaterialRipple"><span class="mdl-ripple"></span></span></a><a class="mdl-layout__tab" href="https://cssicurriculum.withgoogle.com/html.html">HTML &amp; CSS<span class="mdl-layout__tab-ripple-container mdl-js-ripple-effect" data-upgraded=",MaterialRipple"><span class="mdl-ripple"></span></span></a><a class="mdl-layout__tab" href="https://cssicurriculum.withgoogle.com/javascript.html">JavaScript<span class="mdl-layout__tab-ripple-container mdl-js-ripple-effect" data-upgraded=",MaterialRipple"><span class="mdl-ripple"></span></span></a><a class="mdl-layout__tab" href="https://cssicurriculum.withgoogle.com/python.html">Python<span class="mdl-layout__tab-ripple-container mdl-js-ripple-effect" data-upgraded=",MaterialRipple"><span class="mdl-ripple"></span></span></a><a class="mdl-layout__tab" href="https://cssicurriculum.withgoogle.com/app-engine.html">AppEngine<span class="mdl-layout__tab-ripple-container mdl-js-ripple-effect" data-upgraded=",MaterialRipple"><span class="mdl-ripple"></span></span></a><a class="mdl-layout__tab is-active" href="https://cssicurriculum.withgoogle.com/project.html">Project Week<span class="mdl-layout__tab-ripple-container mdl-js-ripple-effect" data-upgraded=",MaterialRipple"><span class="mdl-ripple"></span></span></a><a class="mdl-layout__tab" href="https://cssicurriculum.withgoogle.com/git.html">Git<span class="mdl-layout__tab-ripple-container mdl-js-ripple-effect" data-upgraded=",MaterialRipple"><span class="mdl-ripple"></span></span></a><a class="mdl-layout__tab" href="https://cssicurriculum.withgoogle.com/resources.html">Resources<span class="mdl-layout__tab-ripple-container mdl-js-ripple-effect" data-upgraded=",MaterialRipple"><span class="mdl-ripple"></span></span></a></div><div class="mdl-layout__tab-bar-button mdl-layout__tab-bar-right-button"><i class="material-icons">chevron_right</i></div></div></header><div class="mdl-layout__drawer" aria-hidden="true"><span class="mdl-layout-title">CSSIx Modules</span><nav class="mdl-navigation"><a class="mdl-navigation__link" href="https://cssicurriculum.withgoogle.com/intro.html">Intro</a> <a class="mdl-navigation__link" href="https://cssicurriculum.withgoogle.com/command-line.html">Command Line</a> <a class="mdl-navigation__link" href="https://cssicurriculum.withgoogle.com/html.html">HTML &amp; CSS</a> <a class="mdl-navigation__link" href="https://cssicurriculum.withgoogle.com/javascript.html">JavaScript</a> <a class="mdl-navigation__link" href="https://cssicurriculum.withgoogle.com/python.html">Python</a> <a class="mdl-navigation__link" href="https://cssicurriculum.withgoogle.com/app-engine.html">AppEngine</a> <a class="mdl-navigation__link is-active" href="https://cssicurriculum.withgoogle.com/project.html">Project Week</a> <a class="mdl-navigation__link" href="https://cssicurriculum.withgoogle.com/git.html">Git</a> <a class="mdl-navigation__link" href="https://cssicurriculum.withgoogle.com/resources.html">Resources</a></nav></div><main class="mdl-layout__content cssi-main"><div class="mdl-grid"><div class="mdl-cell mdl-cell--2-col mdl-cell--hide-tablet mdl-cell--hide-phone"></div><div class="cssix-content mdl-color--white mdl-shadow--4dp content mdl-color-text--grey-800 mdl-cell mdl-cell--8-col"><div class="post"><header class="post-header"><div><div class="PageNavigation"><a class="prev" href="https://cssicurriculum.withgoogle.com/B-Project-week/check-helper-ajax.html">« Check Helper (AJAX)</a> <a class="next" href="https://cssicurriculum.withgoogle.com/A-resources/00-intro.html">Resources »</a></div></div></header><article class="post-content"><h1 id="example-app-datastore">Example App: Datastore</h1><p>This app illustrates several concepts relative to Datastore. It’s a fully functional app, although it does not have any template or fancy output. The user interacts with the app by sending one of four types of queries:</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>/add_artist
/add_song
/songs
/artists
</pre></td></tr></tbody></table></code></pre></div></div><p>Some of these requests, as documented in the code, have mandatory request args. The app defines two datastore entries, one for <code class="highlighter-rouge">Song</code>, one for <code class="highlighter-rouge">Artists</code>. It allows users to create a new artist, or list the existing artists. Similarly it allows users to list existing songs, or add new ones to the database.</p><p>Try to read and understand the code:</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">webapp2</span>
<span class="kn">from</span> <span class="nn">google.appengine.ext</span> <span class="kn">import</span> <span class="n">ndb</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>


<span class="c"># First we need to define the "blueprints of the objects that we will</span>
<span class="c"># store in Datastore.</span>

<span class="c"># The first type of data is going to be "Song". Each song has two</span>
<span class="c"># string properties, a title and the artist name. It also has a Date property,</span>
<span class="c"># release date. It's important to mark it as a DateProperty and not a</span>
<span class="c"># string, so that Datastore knows how to index it and compare it with</span>
<span class="c"># other dates.</span>
<span class="c"># For this exercise we are going to assume that the title of a song is UNIQUE.</span>
<span class="c"># No two songs in our database will have the same title.</span>
<span class="k">class</span> <span class="nc">Song</span><span class="p">(</span><span class="n">ndb</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
  <span class="n">title</span> <span class="o">=</span> <span class="n">ndb</span><span class="o">.</span><span class="n">StringProperty</span><span class="p">()</span>
  <span class="n">artist_name</span> <span class="o">=</span> <span class="n">ndb</span><span class="o">.</span><span class="n">StringProperty</span><span class="p">()</span>
  <span class="n">release_date</span> <span class="o">=</span> <span class="n">ndb</span><span class="o">.</span><span class="n">DateProperty</span><span class="p">()</span>

<span class="c"># The other type of data we will store will represent Artists. Here is a simple</span>
<span class="c"># blueprint for it.</span>
<span class="k">class</span> <span class="nc">Artist</span><span class="p">(</span><span class="n">ndb</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
  <span class="n">name</span> <span class="o">=</span> <span class="n">ndb</span><span class="o">.</span><span class="n">StringProperty</span><span class="p">()</span>
  <span class="c"># An artist can have multiple genres. We don't know how many genres, so we use</span>
  <span class="c"># the keyword "repeated" in the definition of the property. It will be stored</span>
  <span class="c"># as a list (of strings).</span>
  <span class="n">genre</span> <span class="o">=</span> <span class="n">ndb</span><span class="o">.</span><span class="n">StringProperty</span><span class="p">(</span><span class="n">repeated</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>


<span class="c"># First handler for /add_artist. The behavior as follows:</span>
<span class="c"># 1) the user makes a GET request, specifying artist &lt;name&gt; and as many genres</span>
<span class="c">#    as needed. See example:</span>
<span class="c">#</span>
<span class="c">#           /add_artist?name=&lt;name&gt;genre=&lt;genre1&gt;&amp;genre=&lt;genre2&gt;</span>
<span class="c">#</span>
<span class="c"># 2) if the user does not specify a &lt;name&gt; or at least one &lt;genre&gt; in the</span>
<span class="c">#    request, return an error</span>
<span class="c"># 3) check if an artist with this name exists already. If there's one, return</span>
<span class="c">#    an error</span>
<span class="c"># 4) create the new user</span>
<span class="c"># 5) store it in datastore</span>
<span class="k">class</span> <span class="nc">AddArtistHandler</span><span class="p">(</span><span class="n">webapp2</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c"># Retrieve the parameters from the user request.</span>
    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'name'</span><span class="p">)</span>
    <span class="c"># Since there can be more than one genre in the request, we use get_all()</span>
    <span class="c"># instead of "get()"</span>
    <span class="n">genre</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">get_all</span><span class="p">(</span><span class="s">'genre'</span><span class="p">)</span>
    <span class="c"># Input validation.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
      <span class="c"># The user has not specified a name, thus "name" was None</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">"You must give me a name"</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">genre</span><span class="p">:</span>
      <span class="c"># If we're here genre was an empty list, meaning tha no "genre" was</span>
      <span class="c"># specified in the request.</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">"You must give me at least one genre"</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="c"># We have all we need to create a new artist, but we must check if the</span>
    <span class="c"># artist is stored already. To search, we will make a query with a filter</span>
    <span class="c"># on artist name.</span>
    <span class="n">artists_query</span> <span class="o">=</span> <span class="n">Artist</span><span class="o">.</span><span class="n">query</span><span class="p">()</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">Artist</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">)</span>
    <span class="c"># Execute the query, fetch() returns an empty list if no entry in the</span>
    <span class="c"># database matches the filter, otherwise it retunrs a list with one or more</span>
    <span class="c"># Artist entries.</span>
    <span class="n">artists</span> <span class="o">=</span> <span class="n">artists_query</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">artists</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="c"># No artist witht his name present in the database, create a new artist.</span>
      <span class="n">artist</span> <span class="o">=</span> <span class="n">Artist</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">genre</span><span class="o">=</span><span class="n">genre</span><span class="p">)</span>
      <span class="c"># The new artist is not stored yet.</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">"I Added "</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="c"># We will assime that there can be AT MOST one entry with the same</span>
      <span class="c"># Artist name. Thus it must be the 0-th element of the list.</span>
      <span class="n">artist</span> <span class="o">=</span> <span class="n">artists</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="c"># Replace the existing genres for this artist in the database with the</span>
      <span class="c"># ones the user specified in the request</span>
      <span class="n">artist</span><span class="o">.</span><span class="n">genre</span> <span class="o">=</span> <span class="n">genre</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">" already exists"</span><span class="p">)</span>
    <span class="c"># STore the new artist, or update the existing one.</span>
    <span class="n">artist</span><span class="o">.</span><span class="n">put</span><span class="p">()</span>

<span class="c"># Second handler lists all existing artists. Optionally the user can specify</span>
<span class="c"># that they only want the artists associated with a specific genre.</span>
<span class="k">class</span> <span class="nc">ListArtistsHandler</span><span class="p">(</span><span class="n">webapp2</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c"># Check if the user has specified what genre they are interested in.</span>
    <span class="n">request_genre</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'genre'</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request_genre</span><span class="p">:</span>
      <span class="c"># If the user has not specified any genre, make a generic query with no</span>
      <span class="c"># filter, and execute it.</span>
      <span class="n">artists</span> <span class="o">=</span> <span class="n">Artist</span><span class="o">.</span><span class="n">query</span><span class="p">()</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="c"># Otherwise make a query with filters. Since genre is a repeated property</span>
      <span class="c"># (a list) in Artist, we cannot check using the equal sign (==). Instead</span>
      <span class="c"># we use the "IN" operator, as illustrated here.</span>
      <span class="c"># Note that the filter can be read as "return all artists in which</span>
      <span class="c"># at least one of the genrese is contained in the following list of</span>
      <span class="c"># genres,"</span>
      <span class="n">artists_query</span> <span class="o">=</span> <span class="n">Artist</span><span class="o">.</span><span class="n">query</span><span class="p">()</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">Artist</span><span class="o">.</span><span class="n">genre</span><span class="o">.</span><span class="n">IN</span><span class="p">([</span><span class="n">request_genre</span><span class="p">]))</span>
      <span class="n">artists</span> <span class="o">=</span> <span class="n">artists</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
    <span class="c"># One way or another, the variable "artists" now contains the list of</span>
    <span class="c"># artists matchine the user request. Let's print them one pe line.</span>
    <span class="c"># We use the Python strong method ".join" to merge all genres for one</span>
    <span class="c"># artist in one string.</span>
    <span class="k">for</span> <span class="n">artist</span> <span class="ow">in</span> <span class="n">artists</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
        <span class="n">artist</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">" - "</span> <span class="o">+</span> <span class="s">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">artist</span><span class="o">.</span><span class="n">genre</span><span class="p">)</span> <span class="o">+</span> <span class="s">"&lt;br&gt;"</span><span class="p">)</span>

<span class="c"># Third handler: add a song. The user must specify the following properties</span>
<span class="c"># in the GET request:</span>
<span class="c"># * title</span>
<span class="c"># * artist</span>
<span class="c"># * release date (format MM-DD-YYYY)</span>
<span class="c"># The handler will follow these steps:</span>
<span class="c"># 1) check if the artist exists</span>
<span class="c"># 2) If it does, check if there is a song already with this name</span>
<span class="c"># 3) If there isn't, it will create a new entry in the database.</span>
<span class="k">class</span> <span class="nc">AddSongHandler</span><span class="p">(</span><span class="n">webapp2</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c"># Extract arguments fron the request</span>
    <span class="n">song_title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'title'</span><span class="p">)</span>
    <span class="n">artist_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'artist'</span><span class="p">)</span>
    <span class="c"># Every argument in the request is a string, but we will convert the date</span>
    <span class="c"># into a date obejct later.</span>
    <span class="n">release_date_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'release_date'</span><span class="p">)</span>
    <span class="c"># Input validation.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">song_title</span><span class="p">:</span>
      <span class="c"># The user has not specified title, thus "song_title" was None</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">"You must give me a song_title"</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">artist_name</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">"You must give me an artist"</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="c"># Is this a known artist?</span>
    <span class="n">artist</span> <span class="o">=</span> <span class="n">Artist</span><span class="o">.</span><span class="n">query</span><span class="p">()</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">Artist</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">artist_name</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">artist</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">"Artist Unknown"</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">release_date_string</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">"You must give me a release_date (MM-DD-YYYY)"</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="c"># Convert the date from string to a date type. This makes use of the</span>
    <span class="c"># function "strptime" of "datetime" to convert a string into a datetime</span>
    <span class="c"># object. Teh second argument of the function is the expected format for</span>
    <span class="c"># the string representation (%m -&gt; month, %d -&gt; day, %Y -&gt; 4-digit year)</span>
    <span class="c"># We call "date()" because we only care about the date, not the time.</span>
    <span class="c">#</span>
    <span class="c"># For more in-depth documentation of this function and datatype, check the</span>
    <span class="c"># online documentation of the datetime library.</span>
    <span class="n">release_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">release_date_string</span><span class="p">,</span> <span class="s">"</span><span class="si">%</span><span class="s">m-</span><span class="si">%</span><span class="s">d-</span><span class="si">%</span><span class="s">Y"</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
    <span class="c"># Do we have a song already with this title (note the assumption here is</span>
    <span class="c"># that no two songs have the same title).</span>
    <span class="n">song_query</span> <span class="o">=</span> <span class="n">Song</span><span class="o">.</span><span class="n">query</span><span class="p">()</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">Song</span><span class="o">.</span><span class="n">title</span> <span class="o">==</span> <span class="n">song_title</span><span class="p">)</span>
    <span class="c"># If you know like in this case that you can expect no more than one return</span>
    <span class="c"># value, you can use get() insted of fetch(). The first retunr an object,</span>
    <span class="c"># or None if there is no matching entry. The second returns a list of all</span>
    <span class="c"># objects matching the request, or an empty list if there isn't any.</span>
    <span class="n">songs</span> <span class="o">=</span> <span class="n">song_query</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">songs</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">"Song already exists"</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="c"># Create a new entry, if we got to this point, the song is unknown, and we</span>
    <span class="c"># know the artist.</span>
    <span class="n">song</span> <span class="o">=</span> <span class="n">Song</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">song_title</span><span class="p">,</span> <span class="n">artist_name</span><span class="o">=</span><span class="n">artist</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">release_date</span><span class="o">=</span><span class="n">release_date</span><span class="p">)</span>
    <span class="c"># Store the new entry</span>
    <span class="n">song</span><span class="o">.</span><span class="n">put</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">"Added "</span> <span class="o">+</span> <span class="n">song_title</span><span class="p">)</span>

<span class="c"># Fourth handler: list all songs:</span>
<span class="c">#</span>
<span class="c"># Lists all songs whose author is a specific artist. Use the release date to</span>
<span class="c"># sort the entries from the oldest song to the newest release.</span>
<span class="c"># If the user does not specify a "artist_name" argument in the request, list</span>
<span class="c"># all songs.</span>
<span class="k">class</span> <span class="nc">ListSongsHandler</span><span class="p">(</span><span class="n">webapp2</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c"># Check if the user has specified an artist_name.</span>
    <span class="n">artist_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'artist_name'</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">artist_name</span><span class="p">:</span>
      <span class="c"># The user has specified an artist name, but is this a known artist?</span>
      <span class="n">artists</span> <span class="o">=</span> <span class="n">Artist</span><span class="o">.</span><span class="n">query</span><span class="p">()</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">Artist</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">artist_name</span><span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">artists</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">"Artist Unknown"</span><span class="p">)</span>
        <span class="k">return</span>
      <span class="c"># Artists is a list of artists with the specified name. Our program</span>
      <span class="c"># enforces that there is only ONE artist with that name (See the</span>
      <span class="c"># add_artist handler), so we will extract the 0-th element of the</span>
      <span class="c"># list to get it.</span>
      <span class="n">artist</span> <span class="o">=</span> <span class="n">artists</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="c"># We know the artist, let's retrieve all songs for that artist.</span>
      <span class="n">all_songs_query</span> <span class="o">=</span> <span class="n">Song</span><span class="o">.</span><span class="n">query</span><span class="p">()</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span>
          <span class="n">Song</span><span class="o">.</span><span class="n">artist_name</span> <span class="o">==</span> <span class="n">artist</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="n">Song</span><span class="o">.</span><span class="n">release_date</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="c"># No artist was specified if we are hers, so let's get all songs</span>
      <span class="c"># without filtering based on artist name.</span>
      <span class="n">all_songs_query</span> <span class="o">=</span> <span class="n">Song</span><span class="o">.</span><span class="n">query</span><span class="p">()</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="n">Song</span><span class="o">.</span><span class="n">release_date</span><span class="p">)</span>
    <span class="c"># We specified a query in one of two ways in the code just above, let's now</span>
    <span class="c"># execute the query to retrieve the data.</span>
    <span class="n">all_songs</span> <span class="o">=</span> <span class="n">all_songs_query</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
    <span class="c"># Let's print the result. Explore the datetime.strftime if you want to</span>
    <span class="c"># print the date in a more fancy format.</span>
    <span class="k">for</span> <span class="n">song</span> <span class="ow">in</span> <span class="n">all_songs</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
        <span class="n">song</span><span class="o">.</span><span class="n">title</span>  <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">song</span><span class="o">.</span><span class="n">artist_name</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">song</span><span class="o">.</span><span class="n">release_date</span><span class="p">))</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">'&lt;br&gt;'</span><span class="p">)</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">webapp2</span><span class="o">.</span><span class="n">WSGIApplication</span><span class="p">([</span>
  <span class="p">(</span><span class="s">'/add_artist'</span><span class="p">,</span> <span class="n">AddArtistHandler</span><span class="p">),</span>
  <span class="p">(</span><span class="s">'/artists'</span><span class="p">,</span> <span class="n">ListArtistsHandler</span><span class="p">),</span>
  <span class="p">(</span><span class="s">'/add_song'</span><span class="p">,</span> <span class="n">AddSongHandler</span><span class="p">),</span>
  <span class="p">(</span><span class="s">'/songs'</span><span class="p">,</span> <span class="n">ListSongsHandler</span><span class="p">),</span>
<span class="p">])</span>
</pre></td></tr></tbody></table></code></pre></div></div><p>If you want to try this app in action, write a simple <code class="highlighter-rouge">app.yaml</code> for it, and try running it. Once it runs, you can make requests directly from the brower by navigating to URLs similar to these:</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre>http://localhost:8080/add_artist
http://localhost:8080/add_artist?name=Bruno%20Mars
http://localhost:8080/add_artist?name=Bruno%20Mars&amp;genre=pop&amp;genre=hip%20hop
http://localhost:8080/add_artist?name=Beyonce&amp;genre=RnB&amp;genre=country
http://localhost:8080/artists
http://localhost:8080/add_song
http://localhost:8080/add_song?title=Hello&amp;artist=Adele
http://localhost:8080/add_song?title=Hello&amp;artist=Adele
http://localhost:8080/add_song?title=Lemonade&amp;artist=Beyonce&amp;release_date=06-04-2017
http://localhost:8080/add_song?title=Lemonade&amp;artist=Beyonce&amp;release_date=06-04-2017
http://localhost:8080/add_song?title=Halo&amp;artist=Beyonce&amp;release_date=04-04-2017
http://localhost:8080/add_song?title=Runaway%20Baby&amp;artist=Bruno%20Mars&amp;release_date=05-04-2016
http://localhost:8080/songs
http://localhost:8080/songs?artist_name=Bruno%20Mars
http://localhost:8080/songs?artist_name=Beyonce

</pre></td></tr></tbody></table></code></pre></div></div></article><footer class="post-footer"><hr><div class="PageNavigation"><a class="prev" href="https://cssicurriculum.withgoogle.com/B-Project-week/check-helper-ajax.html">« Check Helper (AJAX)</a> <a class="next" href="https://cssicurriculum.withgoogle.com/A-resources/00-intro.html">Resources »</a></div></footer></div></div></div></main><footer class="mdl-mini-footer section"><div class="mdl-mini-footer__left-section"><div class="lockup va"><span class="lockup-logo lockup-dark"></span></div></div><div class="mdl-mini-footer__right-section"><ul class="mdl-mini-footer__link-list"><li><span id="site_label">CSSI - Atlanta</span></li><li>--</li><li><a href="https://www.google.com/intl/en/about/">About Google</a></li><li><a href="https://www.google.com/intl/en/policies/privacy/">Privacy</a></li><li><a href="https://www.google.com/intl/en/policies/terms/">Terms</a></li><li><a href="https://cssicurriculum.withgoogle.com/B-Project-week/datastore_example.html#" id="signout_link">Logout</a></li><li><a href="https://cssicurriculum.withgoogle.com/B-Project-week/datastore_example.html#" id="forgetme_link">Forget Me</a></li></ul></div><script src="./Example App - Datastore_files/firebase-app.js.download"></script><script src="./Example App - Datastore_files/firebase-auth.js.download"></script><script src="./Example App - Datastore_files/firebaseui.js.download"></script><link href="./Example App - Datastore_files/firebaseui.css" rel="stylesheet" type="text/css"><script>
  function getCookie(name) {
    let dc = document.cookie;
    let prefix = name + "=";
    let begin = dc.indexOf("; " + prefix);
    if (begin == -1) {
      begin = dc.indexOf(prefix);
      if (begin != 0) return null;
    }
    begin += 2;
    let end = document.cookie.indexOf(";", begin);
    if (end == -1) {
      end = dc.length;
    }
    return decodeURI(dc.substring(begin + prefix.length, end));
  }

  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyD_NpvZGlms1zebBgfE4RZPCim5irYGbG4",
    authDomain: "cssi-curriculum.firebaseapp.com",
    databaseURL: "https://cssi-curriculum.firebaseio.com",
    projectId: "cssi-curriculum",
    storageBucket: "cssi-curriculum.appspot.com",
    messagingSenderId: "443846997353"
  };
  // Firebase log-in widget
  function configureFirebaseLoginWidget() {
    let uiConfig = {
      signInSuccessUrl: '/',
      signInOptions: [
        // Leave the lines as is for the providers you want to offer your users.
        firebase.auth.GoogleAuthProvider.PROVIDER_ID,
        {
            provider: firebase.auth.EmailAuthProvider.PROVIDER_ID,
            // Whether the display name should be displayed in the Sign Up page.
            requireDisplayName: false,
        },
      ],
      callbacks: {
        signInSuccessWithAuthResult: function(authResult, redirectUrl) {
          let user = authResult.user;
          let credential = authResult.credential;
          let isNewUser = authResult.additionalUserInfo.isNewUser;
          let providerId = authResult.additionalUserInfo.providerId;
          let operationType = authResult.operationType;
          // Do something with the returned AuthResult.
          // Return type determines whether we continue the redirect automatically
          // or whether we leave that to developer to handle.
          return true;
        },
        signInFailure: function(error) {
          // Some unrecoverable error occurred during sign-in.
          // Return a promise when error handling is completed and FirebaseUI
          // will reset, clearing any UI. This commonly occurs for error code
          // 'firebaseui/anonymous-upgrade-merge-conflict' when merge conflict
          // occurs. Check below for more details on this.
          return handleUIError(error);
        },
      },
      // Terms of service url
      'tosUrl': 'https://www.google.com/intl/en/policies/terms/',
    };

    let user = firebase.auth().currentUser;
    if (!user && document.getElementById('firebaseui-auth-container')) {
      let ui = new firebaseui.auth.AuthUI(firebase.auth());
      ui.start('#firebaseui-auth-container', uiConfig);
    }
  }

  function updateUserToken(user) {
    let oldCookie = getCookie('idToken');
    if (user) {
      let refresh_token = getCookie('needRefreshToken');
      user.getIdToken(refresh_token == 'true').then(function(idToken) {
        document.cookie = "idToken=" + idToken + "; path=/";
        if (!oldCookie) {
          location.reload();
        }
      });
    } else {
      console.log("Removing auth token");
      document.cookie = "idToken=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC";
      if (oldCookie) {
        location.reload();
      }
    }
  }

  function configureFirebaseLogin() {
    firebase.initializeApp(config);
    firebase.auth().onAuthStateChanged(updateUserToken);
    firebase.auth().onIdTokenChanged(function() {console.log("token changed");});
  }

  function signOut() {
    firebase.auth().signOut();
    window.location = "/";
    return false;
  }

  function forgetMe() {
    let user = firebase.auth().currentUser;
    user.delete().then(function() {
      console.log("User deleted");
    }).catch(function(error) {
      console.log("Error deleting the user " + error);
    });
    firebase.auth().signOut();
    window.location = "/";
    return false;
  }

  function sendVerificationEmail() {
    let user = firebase.auth().currentUser;
    if (user && !user.emailVerified) {
      user.sendEmailVerification().then(function() {
          console.log("Verification email sent.");
        }).catch(function(error) {
          console.log("An error happened while sending the verification email.");
        });
    } else if (user) {
      console.log("Email already verified");
    } else {
      console.log("User not logged in");
    }
    console.log("Removing auth token");
    document.cookie = "idToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC";
    document.querySelector('#send_verification_button').style.display = 'None';
    document.querySelector('#verification_sent').style.display = 'block';
  }

  function checkAndRestoreCookie(){
    let user = firebase.auth().currentUser;
  }

  function showAnswer(event) {
    let show_answer_button = event.currentTarget;
    let answer_container = show_answer_button.parentElement;
    toggleAnswer(answer_container, true);
  }

  function hideAnswer(event) {
    let show_answer_button = event.currentTarget;
    let answer_container = show_answer_button.parentElement;
    toggleAnswer(answer_container, false);
  }

  function toggleAnswer(container, visible) {
    let answer = container.querySelector('.answer');
    answer.style.display = visible ? 'block' : 'none';
    let hide_answer_button = container.querySelector('.hide_answer');
    hide_answer_button.style.display = visible ? 'block' : 'none';
    let show_answer_button = container.querySelector('.show_answer');
    show_answer_button.style.display = visible ? 'none' : 'block';
  }

  function toggleStudentViewCookie(event) {
    const new_value = event.target.checked;
    document.cookie = "student_view=" + new_value + ";path=/";
    location.reload();
  }

  window.addEventListener('load', function() {
    configureFirebaseLogin();
    configureFirebaseLoginWidget();
    //checkAndRestoreCookie();
    let signout_link = document.querySelector('#signout_link');
    if (signout_link) {
      signout_link.onclick = signOut;
    }
    let forgetme_link = document.querySelector('#forgetme_link');
    if (forgetme_link) {
      forgetme_link.onclick = forgetMe;
    }
    let email_verification_btn = document.querySelector('#send_verification_button');
    if (email_verification_btn) {
      email_verification_btn.onclick = sendVerificationEmail;
    }
    let show_answer_btns = document.querySelectorAll('.show_answer');
    show_answer_btns.forEach( function(element) {
      element.onclick = showAnswer;
    });
    let hide_answer_btns = document.querySelectorAll('.hide_answer');
    hide_answer_btns.forEach( function(element) {
      element.onclick = hideAnswer;
    });
    // Student View checkbox not available on all pages, if present,
    // it can be used to override the user role, so that instructors can view
    // content as students.
    let student_view_flag = document.querySelector('#chk_student_view');
    if (student_view_flag) {
      student_view_flag.checked = JSON.parse(getCookie('student_view'));
      student_view_flag.onclick = toggleStudentViewCookie;
    }
    // Select the proper element in the site selection view based on the
    // existing cookies.
    let selected_site = getCookie('site');
    let site_selector_list = document.querySelectorAll('.site_radio');
    [].forEach.call(site_selector_list, (element) => {
      element.addEventListener('click', () => {
        console.log('Clicked ' + element.value);
        document.cookie = "site=" + element.value + ";path=/";
        document.querySelector('#site_label').innerText = element.dataset.label;
      });
    });
    if (selected_site && site_selector_list.length > 0) {
      [].forEach.call(site_selector_list, (element) => {
        console.log(selected_site);
        if (element.value === selected_site) {
          element.checked = true;
        } else {
          element.checked = false;
        }
      });
      console.log(site_selector_list);
    }

  })
</script><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-101261509-1', 'auto');
  ga('send', 'pageview');
</script></footer><div class="mdl-layout__obfuscator"></div></div></div></body></html>